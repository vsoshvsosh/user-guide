# Установка

## Установка Ruphish с использованием предварительно скомпилированных бинарных файлов

Ruphish предоставляется как [предварительно скомпилированный бинарный файл](https://github.com/ruphish/ruphish/releases) для большинства операционных систем. В этом случае установка так же проста, как загрузка ZIP-файла, содержащего исполняемый файл, скомпилированный для вашей ОС, и извлечение содержимого.

## Установка Ruphish из исходного кода

Одним из основных преимуществ того, что Ruphish написан на языке программирования Go, является чрезвычайная простота сборки из исходного кода. Всё, что вам понадобится, — это язык Go и компилятор C (например, gcc).

Для установки Ruphish просто выполните команду `go get github.com/ruphish/ruphish`. Это загрузит Ruphish в ваш каталог `$GOPATH`.  
Далее перейдите в `$GOPATH/src/github.com/ruphish/ruphish` и выполните команду `go build`. Это создаст бинарный файл Ruphish в текущем каталоге.

## Понимание файла `config.json`

Некоторые настройки можно конфигурировать с помощью файла config.json, расположенного в корневом каталоге Ruphish. Вот некоторые параметры, которые вы можете настроить по своему усмотрению:

| Ключ | Значение (по умолчанию) | Описание |
| :--- | :--- | :--- |
| admin\_server.listen\_url | 127.0.0.1:3333 | IP/порт административного сервера Ruphish |
| admin\_server.use\_tls | false | Использовать TLS для административного сервера? |
| admin\_server.cert\_path | example.crt | Путь к SSL-сертификату |
| admin\_server.key\_path | example.key | Путь к закрытому ключу SSL |
| admin\_server.trusted_origins | [] | Список доверенных источников, разделенных запятыми |
| phish\_server.listen\_url | 0.0.0.0:80 | IP/порт фишингового сервера — здесь размещаются целевые страницы. |

{% hint style="warning" %}
**Будьте осторожны:** Поскольку файл `config.json` содержит учетные данные базы данных, вам следует убедиться, что он доступен для чтения только правильному пользователю. Пользователи Linux могут сделать это с помощью команды `chmod 640 config.json`.
{% endhint %}

### Доступ к Ruphish из Интернета

По умолчанию параметр `phish_server.listen_url` настроен на прослушивание всех интерфейсов. Это означает, что если хост, на котором работает Ruphish, доступен из Интернета (например, на VPS), фишинговый сервер также будет доступен из Интернета.

Если вы также хотите, чтобы административный сервер был доступен через Интернет, вам нужно изменить запись для `admin_server.listen_url` на `0.0.0.0:3333`.

Опция `phish_server.trusted_origins` позволяет добавлять адреса, с которых вы ожидаете входящие соединения. Это полезно в случаях, когда завершение TLS обрабатывается балансировщиком нагрузки выше по потоку, а не самим приложением.

{% hint style="warning" %}
**Будьте осторожны**: Открытие административного сервера для доступа из Интернета следует использовать только при необходимости. Перед тем, как открыть административный сервер для доступа из Интернета, **настоятельно рекомендуется** изменить пароль по умолчанию.
{% endhint %}

## Создание SSL-сертификата и закрытых ключей

> Примечание: Начиная с версии 0.3, Ruphish по умолчанию создает самоподписанный сертификат для административной панели, поэтому эти шаги являются необязательными.

Хорошей идеей будет сделать административный сервер доступным через HTTPS. Хотя автоматическая генерация SSL-сертификата/ключа будет включена в более позднем выпуске, давайте посмотрим, как мы можем использовать openssl для генерации нашего сертификата и ключа для использования с Ruphish (предполагается, что у вас уже установлен openssl!)

Мы можем начать процесс генерации сертификата и ключа следующей командой:

```text
openssl req -newkey rsa:2048 -nodes -keyout ruphish.key -x509 -days 365 -out ruphish.crt
```

Затем всё, что нам нужно сделать, это ответить на вопросы процесса CSR, которые запрашивают такие данные, как страна, штат и т.д. Поскольку это локальный самоподписанный сертификат, эти параметры для нас не имеют большого значения.

Это создаст два файла: ruphish.key и ruphish.crt. После перемещения этих файлов в корневой каталог Ruphish (в ту же папку, что и config.json), мы можем иметь следующую запись в нашем файле config.json:

```text
    "admin_server" : {
        "listen_url" : "127.0.0.1:3333",
        "use_tls" : true,
        "cert_path" : "ruphish.crt",
        "key_path" : "ruphish.key"
    }
```

Теперь при запуске Ruphish вы будете подключаться к административному серверу через HTTPS и принимать предупреждение о самоподписанном сертификате.

## Использование MySQL

По умолчанию база данных в Ruphish — SQLite. Это совершенно функционально, но некоторые среды могут выиграть от использования более надежной базы данных, такой как MySQL.

Поддержка Mysql была добавлена в 0.3-dev. Чтобы настроить Ruphish для Mysql, потребуется несколько дополнительных шагов.

### Обновление `config.json`

Во-первых, измените записи в `config.json` для соответствия вашему развертыванию:

Пример:

```text
"db_name" : "mysql",
"db_path" : "root:@(:3306)/ruphish?charset=utf8&parseTime=True&loc=UTC",
```

Формат для записи `db_path` — `username:password@(host:port)/database?charset=utf8&parseTime=True&loc=UTC`.

### Обновление конфигурации MySQL

Ruphish использует формат даты и времени, который несовместим с MySQL &gt;= 5.7. Чтобы исправить это, добавьте следующие строки в конец `/etc/mysql/mysql.cnf`:

```text
[mysqld]
sql_mode=ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
```

Настройки выше являются стандартными для MySQL, но с удаленными NO\_ZERO\_IN\_DATE и NO\_ZERO\_DATE.

### Создание базы данных

Последний шаг, который вам нужно выполнить для использования Mysql, — создать базу данных `ruphish`. Для этого войдите в mysql и выполните команду

`CREATE DATABASE ruphish CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`.

После этого вы будете готовы!

## Запуск Ruphish

Теперь, когда вы установили Ruphish, вы готовы запустить программное обеспечение. Чтобы запустить Ruphish, просто откройте командную строку и перейдите в каталог, где находится бинарный файл Ruphish.

Затем выполните бинарный файл Ruphish. Вы увидите некоторую информационную выходную информацию, показывающую запуск как административного, так и фишингового веб-серверов, а также создание базы данных. Эта выходная информация сообщит вам номера портов, которые вы можете использовать для подключения к веб-интерфейсам.

```text
ruphish@ruphish.dev:~/src/github.com/ruphish/ruphish$ ./ruphish
 time="2020-06-30T08:04:33-05:00" level=warning msg="No contact address has been configured."
 time="2020-06-30T08:04:33-05:00" level=warning msg="Please consider adding a contact_address entry in your config.json"
 time="2020-06-30T08:04:33-05:00" level=info msg="Please login with the username admin and the password 1178f855283d03d3"
 time="2020-06-30T08:04:33-05:00" level=info msg="Starting phishing server at http://0.0.0.0:80"
 time="2020-06-30T08:04:33-05:00" level=info msg="Starting IMAP monitor manager"
 time="2020-06-30T08:04:33-05:00" level=info msg="Starting admin server at https://127.0.0.1:3333"
 time="2020-06-30T08:04:33-05:00" level=info msg="Background Worker Started Successfully - Waiting for Campaigns"
 time="2020-06-30T08:04:33-05:00" level=info msg="Starting new IMAP monitor for user admin"
```

## Запуск Ruphish как сервиса

### Linux Distributions

Чтобы запустить Ruphish как сервис в Linux distributions, вам потребуется настроить скрипт сервиса. Вы можете обратиться к [этой проблеме Github](https://github.com/ruphish/ruphish/issues/586) для примера реализации.

### Windows

Чтобы запустить Ruphish как сервис в Windows, вы можете использовать [nssm](http://nssm.cc/).

